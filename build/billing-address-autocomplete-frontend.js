(()=>{"use strict";var e={20:(e,t,s)=>{var r=s(609),o=Symbol.for("react.element"),n=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,s){var r,l={},c=null,i=null;for(r in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(i=t.ref),t)n.call(t,r)&&!d.hasOwnProperty(r)&&(l[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===l[r]&&(l[r]=t[r]);return{$$typeof:o,type:e,key:c,ref:i,props:l,_owner:a.current}}},848:(e,t,s)=>{e.exports=s(20)},609:e=>{e.exports=window.React}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}const r=window.wc.blocksCheckout,o=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"postcode-eu-address-validation/billing-address-autocomplete","version":"1.0.0","title":"International Address Autocomplete","category":"woocommerce","description":"Autocomplete international addresses using the Postcode.eu API.","example":{},"parent":["woocommerce/checkout-billing-address-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"postcode-eu-address-validation"}');var n=s(609);const a=window.wp.data,d=window.wc.wcBlocksData,l=window.wp.element,c=window.wc.wcSettings,i=window.wp.i18n,u=window.wc.blocksComponents;function p(e,t,s){let r=t,o=s;return x.reverseStreetLineCountries.includes(e)&&([r,o]=[o,r]),`${r} ${o}`.trim()}function m(e){return["address_1","city","postcode"].every((t=>void 0===(0,a.select)(d.VALIDATION_STORE_KEY).getValidationError(`${e}_${t}`)))}var E,f;null!==(f=(E=PostcodeNl).addressDetailsCache)&&void 0!==f||(E.addressDetailsCache=new Map);let h=!1;const v=({id:e,addressType:t,address:s,setAddress:r,setFormattedAddress:o,addressRef:c,resetAddress:E,didInit:f})=>{const v=(0,l.useRef)(null),[_,g]=(0,l.useState)(!1),[w,A]=(0,l.useState)(!1),[b,y]=(0,l.useState)((()=>f?"":(e=>["postcode","city","address_1","address_2"].map((t=>e[t])).join(" ").trim())(s))),I=(0,l.useRef)(b),{setValidationErrors:C,clearValidationError:S}=(0,a.useDispatch)(d.VALIDATION_STORE_KEY),N=function(e){const t=(0,n.useRef)(null),s=(0,n.useCallback)((e=>PostcodeNl.addressDetailsCache.has(e)?Promise.resolve(PostcodeNl.addressDetailsCache.get(e)):new Promise((s=>{t.current.getDetails(e,(t=>{s(t),PostcodeNl.addressDetailsCache.set(e,t)}))}))),[]),r=(0,n.useCallback)(((...s)=>t.current.search(e.current,...s)),[]);return(0,n.useEffect)((()=>(t.current=new PostcodeNl.AutocompleteAddress(e.current,{autocompleteUrl:x.autocomplete,addressDetailsUrl:x.getDetails}),t.current.getSuggestions=function(e,t,s){const r=(new TextEncoder).encode(t),o=Array.from(r,(e=>String.fromCodePoint(e))).join(""),n=this.options.autocompleteUrl.replace("${context}",encodeURIComponent(e)).replace("${term}",encodeURIComponent(btoa(o)));return this.xhrGet(`${n}`,s)},t.current.getDetails=function(e,t){const s=this.options.addressDetailsUrl.replace("${context}",encodeURIComponent(e));return this.xhrGet(s,t)},()=>t.current.destroy())),[e]),{get instance(){return t.current},getAddressDetails:s,search:r}}(v,s.country),{validationError:T,validationErrorId:O}=(0,a.useSelect)((t=>{const s=t(d.VALIDATION_STORE_KEY);return{validationError:s.getValidationError(e),validationErrorId:s.getValidationErrorId(e)}})),D=(0,l.useCallback)(((s=!0)=>{m(t)?S(e):C({[e]:{message:(0,i.__)("Please enter an address and select it","postcode-eu-address-validation"),hidden:s}})}),[t,e,S,C]),V=(0,l.useCallback)((e=>{g(!0),N.getAddressDetails(e.context).then((e=>{const{locality:t,street:s,postcode:n,building:a}=e.address;r({...c.current,address_1:p(e.country.iso2Code,s,a),city:t,postcode:n}),"default"===x.displayMode&&o(e.mailLines.join("\n")),D(!1)})).finally((()=>g(!1)))}),[g,r,o,D]),k=(0,l.useCallback)((()=>{v.current.addEventListener("autocomplete-response",(e=>{const t=e.detail.matches;1===t.length&&"Address"===t[0].precision?V(t[0]):D(!0)}),{once:!0}),N.search({term:I.current,showMenu:!1})}),[V,D]);(0,l.useEffect)((()=>{v.current.addEventListener("autocomplete-select",(e=>{y(e.detail.value),e.preventDefault(),"Address"===e.detail.precision&&V(e.detail)})),v.current.addEventListener("autocomplete-search",E),v.current.addEventListener("autocomplete-error",(()=>{g(!1),C({[e]:{message:(0,i.__)("An error has occurred while retrieving address data. Please contact us if the problem persists.","postcode-eu-address-validation"),hidden:!1}})})),v.current.addEventListener("autocomplete-open",(()=>A(!0))),v.current.addEventListener("autocomplete-close",(()=>A(!1)))}),[y,E,g,C,A]),(0,l.useEffect)((()=>{var t;h&&(N.instance.reset(),y("")),N.instance.setCountry(x.enabledCountries[s.country].iso3),E();const r=(0,a.select)(d.VALIDATION_STORE_KEY).getValidationError(e);D(null===(t=r?.hidden)||void 0===t||t)}),[s.country,E,y,e]),(0,l.useEffect)((()=>()=>S(e)),[S,e]),(0,l.useEffect)((()=>{v.current.classList.toggle(`${N.instance.options.cssPrefix}loading`,_)}),[_]),(0,l.useEffect)((()=>{k(),h=!0}),[k]);const R=T?.message&&!T?.hidden;return(0,n.createElement)(u.TextInput,{id:e,required:!0,className:{"has-error":R},ref:v,label:(0,i.__)("Start typing your address or zip/postal code","postcode-eu-address-validation"),value:b,onChange:e=>{D(!0),y(e)},onBlur:()=>!w&&D(!1),"aria-invalid":!0===R,ariaDescribedBy:R&&O?O:null,feedback:(0,n.createElement)(u.ValidationInputError,{propertyName:e,elementId:e}),title:""})},_=(0,l.forwardRef)((function({icon:e,size:t=24,...s},r){return(0,l.cloneElement)(e,{width:t,height:t,...s,ref:r})})),g=window.wp.primitives;var w=s(848);const A=(0,w.jsx)(g.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,w.jsx)(g.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),b=({forId:e,onClick:t})=>{const s=(0,a.useSelect)((t=>t(d.VALIDATION_STORE_KEY).getValidationError(e))),{clearValidationError:r}=(0,a.useDispatch)(d.VALIDATION_STORE_KEY);return s&&!s.hidden?(0,n.createElement)("span",{className:"postcode-eu-autofill-intl-bypass"},(0,n.createElement)(_,{icon:A}),(0,n.createElement)("a",{onClick:()=>{r(e),t()}},(0,i.__)("Enter an address"))):null},y=/([1-9]\d{3})\s*([A-Z]{2})/i,I=/([1-9]\d{0,4})(\D.*)?$/i,C=Object.freeze({VALID:"valid",NOT_FOUND:"notFound",ADDITION_INCORRECT:"houseNumberAdditionIncorrect"}),S="_",N=({addressType:e,address:t,setAddress:s,setFormattedAddress:r,addressRef:o,resetAddress:c,didInit:p})=>{var E;const f=`${e}-postcode-eu-postcode`,h=`${e}-postcode-eu-house_number`,v=`${e}-postcode-eu-house_number_select`,_=`${e}-postcode-eu-address-lookup-error`,[g,w]=(0,l.useState)(null!==(E=t.postcode)&&void 0!==E?E:""),[A,b]=(0,l.useState)((()=>p?"":(e=>{const t=[...`${e.address_1} ${e.address_2}`.matchAll(/[1-9]\d{0,4}\D*/g)];return 0===t[0]?.index&&t.shift(),1===t.length?t[0][0].trim():""})(t))),[N,T]=(0,l.useState)(S),[O,D]=(0,l.useState)([]),[k,$]=(0,l.useState)(null),[L,P]=(0,l.useState)(null),[j,U]=(0,l.useState)(!1),[K,M]=(0,l.useState)({status:null,address:null}),Y=(0,l.useRef)(),{setValidationErrors:B,clearValidationError:F}=(0,a.useDispatch)(d.VALIDATION_STORE_KEY),H=(0,l.useCallback)((()=>m(e)),[e]),Z=(0,l.useCallback)((e=>{const t=y.exec(e.value);return $(null===t?null:t[1]+t[2]),H()||null!==t}),[$]),G=(0,l.useCallback)((e=>{var t;const s=I.exec(e.value);return P(null===s?null:`${s[1]} ${null!==(t=s[2]?.trim())&&void 0!==t?t:""}`.trim()),H()||null!==s}),[P]),z=(0,l.useCallback)((({status:e,address:t})=>{F(_),e===C.NOT_FOUND?B({[_]:{message:(0,i.__)("Address not found.","postcode-eu-address-validation"),hidden:!1}}):e===C.ADDITION_INCORRECT&&D(t.houseNumberAdditions.map((e=>({value:e,label:`${t.houseNumber} ${e}`.trim()}))))}),[F,_,B,D]);return(0,l.useEffect)((()=>{if(c(),D([]),T(S),null!==k&&null!==L)return Y.current=window.setTimeout((()=>{U(!0),((e,t)=>{const s=x.dutchAddressLookup.replace("${postcode}",encodeURIComponent(e)).replace("${houseNumberAndAddition}",encodeURIComponent(t));return fetch(s).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)}))})(k,L).then((e=>{z(e),M(e)})).catch((()=>{B({[_]:{message:(0,i.__)("An error has occurred. Please try again later or contact us.","postcode-eu-address-validation"),hidden:!1}})})).finally((()=>U(!1)))}),750),()=>window.clearTimeout(Y.current)}),[c,D,T,k,L,U,M]),(0,l.useEffect)((()=>{const{status:e,address:t}=K;if(e===C.VALID){var n;const e=`${t.houseNumber} ${null!==(n=t.houseNumberAddition)&&void 0!==n?n:""}`.trim();s({...o.current,address_1:`${t.street} ${e}`,city:t.city,postcode:t.postcode}),"default"===x.displayMode&&r(`${t.street} ${e}\n${t.postcode} ${t.city}`)}else c(),r(null)}),[K,r,s,c]),(0,l.useEffect)((()=>()=>F(_)),[F,_]),(0,l.useEffect)((()=>{M((e=>{if(null===e.address)return e;const t=N===S;return{address:{...e.address,houseNumberAddition:t?null:N},status:t?null:C.VALID}}))}),[N,M]),(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.ValidatedTextInput,{id:f,label:(0,i.__)("Postcode","postcode-eu-address-validation"),value:g,onChange:w,customValidation:Z,errorMessage:(0,i.__)("Please enter a valid postcode","postcode-eu-address-validation")}),(0,n.createElement)(u.ValidatedTextInput,{id:h,label:(0,i.__)("House number and addition","postcode-eu-address-validation"),value:A,onChange:b,customValidation:G,errorMessage:(0,i.__)("Please enter a valid house number","postcode-eu-address-validation")}),O.length>0&&(0,n.createElement)(V,{id:v,options:O,value:N,onChange:T}),(0,n.createElement)("div",{className:"postcode-eu-address-lookup-status"},j&&(0,n.createElement)(u.Spinner,null),(0,n.createElement)(R,{id:_})))};function T(e){var t,s,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(s=T(e[t]))&&(r&&(r+=" "),r+=s)}else for(s in e)e[s]&&(r&&(r+=" "),r+=s);return r}const O=function(){for(var e,t,s=0,r="",o=arguments.length;s<o;s++)(e=arguments[s])&&(t=T(e))&&(r&&(r+=" "),r+=t);return r},D=(0,w.jsx)(g.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,w.jsx)(g.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),V=({id:e,onChange:t,options:s=[],value:r=S})=>{const{setValidationErrors:o,clearValidationError:c}=(0,a.useDispatch)(d.VALIDATION_STORE_KEY),{validationError:p,validationErrorId:m}=(0,a.useSelect)((t=>{const s=t(d.VALIDATION_STORE_KEY);return{validationError:s.getValidationError(e),validationErrorId:s.getValidationErrorId(e)}}));(0,l.useEffect)((()=>(r===S?o({[e]:{message:(0,i.__)("Please select a house number","postcode-eu-address-validation"),hidden:!0}}):c(e),()=>c(e))),[r,o,c]);const E=p?.message&&!p?.hidden;return(0,n.createElement)("div",{className:O("postcode-eu-house-number-select",{"has-error":E})},(0,n.createElement)("div",{className:"wc-blocks-components-select"},(0,n.createElement)("div",{className:"wc-blocks-components-select__container"},(0,n.createElement)("label",{htmlFor:e,className:"wc-blocks-components-select__label"},(0,i.__)("Which house number do you mean?","postcode-eu-address-validation")),(0,n.createElement)("select",{className:"wc-blocks-components-select__select",id:e,onChange:e=>t(e.target.value),value:r,"aria-invalid":E,"aria-errormessage":m},(0,n.createElement)("option",{key:S,value:S},(0,i.__)("Select house number","postcode-eu-address-validation")),s.map((e=>(0,n.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,n.createElement)(_,{className:"wc-blocks-components-select__expand",icon:D}))),(0,n.createElement)(u.ValidationInputError,{propertyName:e,elementId:e}))},k=(0,w.jsx)(g.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,w.jsx)(g.Path,{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM12.75 8V13H11.25V8H12.75ZM12.75 14.5V16H11.25V14.5H12.75Z"})}),R=({id:e})=>{const{error:t,errorId:s}=(0,a.useSelect)((t=>{const s=t(d.VALIDATION_STORE_KEY);return{error:s.getValidationError(e),errorId:s.getValidationErrorId(e)}}));return t?.hidden||!t?.message?null:(0,n.createElement)("div",{className:"postcode-eu-address-lookup-error",role:"alert"},(0,n.createElement)("p",{id:s},(0,n.createElement)(_,{icon:k}),(0,n.createElement)("span",null,t.message)))},$=({formattedAddress:e})=>e?(0,n.createElement)("address",{className:"postcode-eu-autofill-address"},e):null,x=(0,c.getSetting)("postcode-eu-address-validation_data");let L=!1;const P=({addressType:e,address:t,setAddress:s})=>{const r=(0,l.useRef)(null),o=(0,l.useRef)(t),[a,d]=(0,l.useState)(null),[c,i]=(0,l.useState)(!1),u=`${e}-postcode-eu-address_autocomplete`,p=Object.hasOwn(x.enabledCountries,t.country);o.current=t;const m=(0,l.useCallback)((()=>{s({...o.current,address_1:"",city:"",postcode:""}),d(null)}),[s,d]);(0,l.useEffect)((()=>{const t=()=>{const t=document.getElementById(`${e}-address_1`)?.parentElement;return t?.before(r.current),t};if(!t()){const e=new MutationObserver((s=>{s.forEach((()=>{t()&&e.disconnect()}))}));return e.observe(r.current.closest(".wc-block-components-checkout-step__content"),{childList:!0}),()=>e.disconnect()}}),[]),(0,l.useEffect)((()=>{if("showAll"!==x.displayMode)for(const t of["address_1","postcode","city"]){const s=document.getElementById(`${e}-${t}`)?.parentElement;s&&(s.style.display=c?"none":"")}}),[e,c]),(0,l.useEffect)((()=>{i(p)}),[i,p]),(0,l.useEffect)((()=>{L=!0}),[]);const E={addressType:e,address:t,setAddress:s,setFormattedAddress:d,addressRef:o,resetAddress:m,didInit:L};return(0,n.createElement)("div",{className:"postcode-eu-autofill-container",ref:r,style:c?{}:{display:"none"}},p&&(0,n.createElement)(n.Fragment,null,"NL"===t.country&&"postcodeOnly"===x.netherlandsMode?(0,n.createElement)(N,{...E}):(0,n.createElement)(v,{id:u,...E}),"showAll"!==x.displayMode&&(0,n.createElement)(b,{forId:u,onClick:()=>i(!1)}),(0,n.createElement)($,{formattedAddress:a})))};(0,r.registerCheckoutBlock)({metadata:o,component:()=>{const{getUseShippingAsBilling:e,getEditingBillingAddress:t}=(0,a.useSelect)((e=>e(d.CHECKOUT_STORE_KEY)),[]),{billingAddress:s}=(0,a.useSelect)((e=>e(d.CART_STORE_KEY).getCustomerData()),[]),{setBillingAddress:r}=(0,a.useDispatch)(d.CART_STORE_KEY);return e()||!1===t()?null:(0,n.createElement)(P,{addressType:"billing",address:s,setAddress:r})}})})();