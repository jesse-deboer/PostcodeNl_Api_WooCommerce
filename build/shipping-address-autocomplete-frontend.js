(()=>{"use strict";var e={20:(e,t,o)=>{var s=o(609),n=Symbol.for("react.element"),r=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),d=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,o){var s,i={},l=null,c=null;for(s in void 0!==o&&(l=""+o),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)r.call(t,s)&&!a.hasOwnProperty(s)&&(i[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===i[s]&&(i[s]=t[s]);return{$$typeof:n,type:e,key:l,ref:c,props:i,_owner:d.current}}},609:e=>{e.exports=window.React},848:(e,t,o)=>{e.exports=o(20)}},t={};function o(s){var n=t[s];if(void 0!==n)return n.exports;var r=t[s]={exports:{}};return e[s](r,r.exports,o),r.exports}const s=window.wc.blocksCheckout,n=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"postcode-eu-address-validation/shipping-address-autocomplete","version":"1.0.0","title":"International Address Autocomplete","category":"woocommerce","description":"Autocomplete international addresses using the Postcode.eu API.","example":{},"parent":["woocommerce/checkout-shipping-address-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"postcode-eu-address-validation"}');var r=o(609);const d=window.wp.data,a=window.wp.element,i=window.wc.wcBlocksData,l=window.wc.wcSettings,c=window.wp.i18n,u=window.wc.blocksComponents;function p(e){return["address_1","city","postcode"].every((t=>void 0===(0,d.select)(i.VALIDATION_STORE_KEY).getValidationError(`${e}_${t}`)))}var m,g;null!==(g=(m=PostcodeNl).addressDetailsCache)&&void 0!==g||(m.addressDetailsCache=new Map);const f={street:"street",houseNumber:"houseNumber",houseNumberAddition:"houseNumberAddition",city:"city",streetAndHouseNumber:"streetAndHouseNumber",postcode:"postcode",houseNumberAndAddition:"houseNumberAndAddition",province:"province"},E={address_1:f.streetAndHouseNumber,address_2:null,postcode:f.postcode,city:f.city,state:f.province,street_name:f.street,house_number:f.houseNumber,house_number_suffix:f.houseNumberAddition};function w(e,t,o){console.log("=== Field Mapping Debug ==="),console.log("Address object before mapping:",t),console.log("Field mapping configuration:",o),console.log("Available address parts:",e);const s={...t},n={street:e.address?.street||"",houseNumber:e.address?.buildingNumber||"",houseNumberAddition:e.address?.buildingNumberAddition||"",city:e.address?.locality||"",postcode:e.address?.postcode||"",province:e.address?.province||null,streetAndHouseNumber:e.streetLine||"",houseNumberAndAddition:e.address?`${e.address.buildingNumber||""} ${e.address.buildingNumberAddition||""}`.trim():""};console.log("Flattened address parts for mapping:",n);for(const[e,t]of Object.entries(o)){if(!t||""===t){console.log(`⏭️ Skipped "${e}" (addressPart: "${t}", available: false)`);continue}const o=n[t];null!=o&&""!==o?e.includes("/")?(s[e]=o,console.log(`✅ Mapped custom field "${e}" = "${o}" (from ${t}) - set in both extensions and direct property`)):(s[e]=o,console.log(`✅ Mapped standard field "${e}" = "${o}" (from ${t})`)):console.log(`⏭️ Skipped "${e}" (addressPart: "${t}", value: "${o}", available: false)`)}return console.log("Address object after mapping:",s),console.log("=== End Debug ==="),s}function h(){return console.log("=== GetFieldMapping Debug ==="),console.log("window available:","undefined"!=typeof window),console.log("window.PostcodeEuSettings available:","undefined"!=typeof window&&!!window.PostcodeEuSettings),"undefined"!=typeof window&&window.PostcodeEuSettings&&(console.log("Full PostcodeEuSettings object:",window.PostcodeEuSettings),console.log("customFieldMapping property:",window.PostcodeEuSettings.customFieldMapping),console.log("customFieldMapping type:",typeof window.PostcodeEuSettings.customFieldMapping),console.log("customFieldMapping keys:",window.PostcodeEuSettings.customFieldMapping?Object.keys(window.PostcodeEuSettings.customFieldMapping):"none")),"undefined"!=typeof window&&window.PostcodeEuSettings?.customFieldMapping?(console.log("✅ Using field mapping from WordPress admin settings:",window.PostcodeEuSettings.customFieldMapping),console.log("=== End GetFieldMapping Debug ==="),window.PostcodeEuSettings.customFieldMapping):(console.log("❌ Falling back to default field mapping:",E),console.log("=== End GetFieldMapping Debug ==="),E)}let b=!1;const v=({id:e,addressType:t,address:o,setAddress:s,setFormattedAddress:n,addressRef:l,resetAddress:m,didInit:g})=>{const f=(0,a.useRef)(null),[E,v]=(0,a.useState)(!1),[_,A]=(0,a.useState)(!1),[y,S]=(0,a.useState)((()=>g?"":(e=>["postcode","city","address_1","address_2"].map((t=>e[t])).join(" ").trim())(o))),N=(0,a.useRef)(y),{setValidationErrors:I,clearValidationError:C}=(0,d.useDispatch)(i.VALIDATION_STORE_KEY),D=function(e){const t=(0,r.useRef)(null),o=(0,r.useCallback)((e=>PostcodeNl.addressDetailsCache.has(e)?Promise.resolve(PostcodeNl.addressDetailsCache.get(e)):new Promise((o=>{t.current.getDetails(e,(t=>{o(t),PostcodeNl.addressDetailsCache.set(e,t)}))}))),[]),s=(0,r.useCallback)(((...o)=>t.current.search(e.current,...o)),[]);return(0,r.useEffect)((()=>(t.current=new PostcodeNl.AutocompleteAddress(e.current,{autocompleteUrl:M.autocomplete,addressDetailsUrl:M.getDetails}),t.current.getSuggestions=function(e,t,o){const s=(new TextEncoder).encode(t),n=Array.from(s,(e=>String.fromCodePoint(e))).join(""),r=this.options.autocompleteUrl.replace("${context}",encodeURIComponent(e)).replace("${term}",encodeURIComponent(btoa(n)));return this.xhrGet(`${r}`,o)},t.current.getDetails=function(e,t){const o=this.options.addressDetailsUrl.replace("${context}",encodeURIComponent(e));return this.xhrGet(o,t)},()=>t.current.destroy())),[e]),{get instance(){return t.current},getAddressDetails:o,search:s}}(f,o.country),{validationError:P,validationErrorId:k}=(0,d.useSelect)((t=>{const o=t(i.VALIDATION_STORE_KEY);return{validationError:o.getValidationError(e),validationErrorId:o.getValidationErrorId(e)}})),O=(0,a.useCallback)(((o=!0)=>{p(t)?C(e):I({[e]:{message:(0,c.__)("Please enter an address and select it","postcode-eu-address-validation"),hidden:o}})}),[t,e,C,I]),$=(0,a.useCallback)((e=>{v(!0),D.getAddressDetails(e.context).then((e=>{const t=h();console.log("=== Field Mapping Configuration Debug ==="),console.log("Field mapping loaded:",t),console.log("PostcodeEuSettings available:","undefined"!=typeof window?!!window.PostcodeEuSettings:"window not available"),"undefined"!=typeof window&&window.PostcodeEuSettings&&console.log("PostcodeEuSettings.customFieldMapping:",window.PostcodeEuSettings.customFieldMapping),console.log("=== End Configuration Debug ===");const o=w(e,l.current,t);s(o),"default"===M.displayMode&&n(e.mailLines.join("\n")),O(!1)})).finally((()=>v(!1)))}),[v,s,n,O]),T=(0,a.useCallback)((()=>{f.current.addEventListener("autocomplete-response",(e=>{const t=e.detail.matches;1===t.length&&"Address"===t[0].precision?$(t[0]):O(!0)}),{once:!0}),D.search({term:N.current,showMenu:!1})}),[$,O]);(0,a.useEffect)((()=>{f.current.addEventListener("autocomplete-select",(e=>{S(e.detail.value),e.preventDefault(),"Address"===e.detail.precision&&$(e.detail)})),f.current.addEventListener("autocomplete-search",m),f.current.addEventListener("autocomplete-error",(()=>{v(!1),I({[e]:{message:(0,c.__)("An error has occurred while retrieving address data. Please contact us if the problem persists.","postcode-eu-address-validation"),hidden:!1}})})),f.current.addEventListener("autocomplete-open",(()=>A(!0))),f.current.addEventListener("autocomplete-close",(()=>A(!1)))}),[S,m,v,I,A]),(0,a.useEffect)((()=>{var t;b&&(D.instance.reset(),S("")),D.instance.setCountry(M.enabledCountries[o.country].iso3),m();const s=(0,d.select)(i.VALIDATION_STORE_KEY).getValidationError(e);O(null===(t=s?.hidden)||void 0===t||t)}),[o.country,m,S,e]),(0,a.useEffect)((()=>()=>C(e)),[C,e]),(0,a.useEffect)((()=>{f.current.classList.toggle(`${D.instance.options.cssPrefix}loading`,E)}),[E]),(0,a.useEffect)((()=>{T(),b=!0}),[T]);const V=P?.message&&!P?.hidden;return(0,r.createElement)(u.TextInput,{id:e,required:!0,className:{"has-error":V},ref:f,label:(0,c.__)("Start typing your address or zip/postal code","postcode-eu-address-validation"),value:y,onChange:e=>{O(!0),S(e)},onBlur:()=>!_&&O(!1),"aria-invalid":!0===V,ariaDescribedBy:V&&k?k:null,feedback:(0,r.createElement)(u.ValidationInputError,{propertyName:e,elementId:e}),title:""})},_=(0,a.forwardRef)((function({icon:e,size:t=24,...o},s){return(0,a.cloneElement)(e,{width:t,height:t,...o,ref:s})})),A=window.wp.primitives;var y=o(848);const S=(0,y.jsx)(A.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,y.jsx)(A.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),N=({forId:e,onClick:t})=>{const o=(0,d.useSelect)((t=>t(i.VALIDATION_STORE_KEY).getValidationError(e))),{clearValidationError:s}=(0,d.useDispatch)(i.VALIDATION_STORE_KEY);return o&&!o.hidden?(0,r.createElement)("span",{className:"postcode-eu-autofill-intl-bypass"},(0,r.createElement)(_,{icon:S}),(0,r.createElement)("a",{onClick:()=>{s(e),t()}},(0,c.__)("Enter an address"))):null},I=/([1-9]\d{3})\s*([A-Z]{2})/i,C=/([1-9]\d{0,4})(\D.*)?$/i,D=Object.freeze({VALID:"valid",NOT_FOUND:"notFound",ADDITION_INCORRECT:"houseNumberAdditionIncorrect"}),P="_",k=({addressType:e,address:t,setAddress:o,setFormattedAddress:s,addressRef:n,resetAddress:l,didInit:m})=>{var g;const f=`${e}-postcode-eu-postcode`,E=`${e}-postcode-eu-house_number`,b=`${e}-postcode-eu-house_number_select`,v=`${e}-postcode-eu-address-lookup-error`,[_,A]=(0,a.useState)(null!==(g=t.postcode)&&void 0!==g?g:""),[y,S]=(0,a.useState)((()=>m?"":(e=>{const t=[...`${e.address_1} ${e.address_2}`.matchAll(/[1-9]\d{0,4}\D*/g)];return 0===t[0]?.index&&t.shift(),1===t.length?t[0][0].trim():""})(t))),[N,k]=(0,a.useState)(P),[O,$]=(0,a.useState)([]),[T,R]=(0,a.useState)(null),[F,L]=(0,a.useState)(null),[j,U]=(0,a.useState)(!1),[K,Y]=(0,a.useState)({status:null,address:null}),B=(0,a.useRef)(),{setValidationErrors:H,clearValidationError:G}=(0,d.useDispatch)(i.VALIDATION_STORE_KEY),Z=(0,a.useCallback)((()=>p(e)),[e]),z=(0,a.useCallback)((e=>{const t=I.exec(e.value);return R(null===t?null:t[1]+t[2]),Z()||null!==t}),[R]),W=(0,a.useCallback)((e=>{var t;const o=C.exec(e.value);return L(null===o?null:`${o[1]} ${null!==(t=o[2]?.trim())&&void 0!==t?t:""}`.trim()),Z()||null!==o}),[L]),q=(0,a.useCallback)((({status:e,address:t})=>{G(v),e===D.NOT_FOUND?H({[v]:{message:(0,c.__)("Address not found.","postcode-eu-address-validation"),hidden:!1}}):e===D.ADDITION_INCORRECT&&$(t.houseNumberAdditions.map((e=>({value:e,label:`${t.houseNumber} ${e}`.trim()}))))}),[G,v,H,$]);return(0,a.useEffect)((()=>{if(l(),$([]),k(P),null!==T&&null!==F)return B.current=window.setTimeout((()=>{U(!0),((e,t)=>{const o=M.dutchAddressLookup.replace("${postcode}",encodeURIComponent(e)).replace("${houseNumberAndAddition}",encodeURIComponent(t));return fetch(o).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)}))})(T,F).then((e=>{q(e),Y(e)})).catch((()=>{H({[v]:{message:(0,c.__)("An error has occurred. Please try again later or contact us.","postcode-eu-address-validation"),hidden:!1}})})).finally((()=>U(!1)))}),750),()=>window.clearTimeout(B.current)}),[l,$,k,T,F,U,Y]),(0,a.useEffect)((()=>{const{status:e,address:t}=K;if(e===D.VALID){var r;const e=`${t.houseNumber} ${null!==(r=t.houseNumberAddition)&&void 0!==r?r:""}`.trim(),d={streetLine:`${t.street} ${e}`,address:{street:t.street,buildingNumber:t.houseNumber,buildingNumberAddition:t.houseNumberAddition,locality:t.city,postcode:t.postcode,province:null}},a=h();console.log("=== Field Mapping Configuration Debug (NL) ==="),console.log("Field mapping loaded:",a),console.log("PostcodeEuSettings available:","undefined"!=typeof window?!!window.PostcodeEuSettings:"window not available"),"undefined"!=typeof window&&window.PostcodeEuSettings&&console.log("PostcodeEuSettings.customFieldMapping:",window.PostcodeEuSettings.customFieldMapping),console.log("=== End Configuration Debug (NL) ===");const i=w(d,n.current,a);o(i),"default"===M.displayMode&&s(`${t.street} ${e}\n${t.postcode} ${t.city}`)}else l(),s(null)}),[K,s,o,l]),(0,a.useEffect)((()=>()=>G(v)),[G,v]),(0,a.useEffect)((()=>{Y((e=>{if(null===e.address)return e;const t=N===P;return{address:{...e.address,houseNumberAddition:t?null:N},status:t?null:D.VALID}}))}),[N,Y]),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(u.ValidatedTextInput,{id:f,label:(0,c.__)("Postcode","postcode-eu-address-validation"),value:_,onChange:A,customValidation:z,errorMessage:(0,c.__)("Please enter a valid postcode","postcode-eu-address-validation")}),(0,r.createElement)(u.ValidatedTextInput,{id:E,label:(0,c.__)("House number and addition","postcode-eu-address-validation"),value:y,onChange:S,customValidation:W,errorMessage:(0,c.__)("Please enter a valid house number","postcode-eu-address-validation")}),O.length>0&&(0,r.createElement)(V,{id:b,options:O,value:N,onChange:k}),(0,r.createElement)("div",{className:"postcode-eu-address-lookup-status"},j&&(0,r.createElement)(u.Spinner,null),(0,r.createElement)(x,{id:v})))};function O(e){var t,o,s="";if("string"==typeof e||"number"==typeof e)s+=e;else if("object"==typeof e)if(Array.isArray(e)){var n=e.length;for(t=0;t<n;t++)e[t]&&(o=O(e[t]))&&(s&&(s+=" "),s+=o)}else for(o in e)e[o]&&(s&&(s+=" "),s+=o);return s}const $=function(){for(var e,t,o=0,s="",n=arguments.length;o<n;o++)(e=arguments[o])&&(t=O(e))&&(s&&(s+=" "),s+=t);return s},T=(0,y.jsx)(A.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,y.jsx)(A.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),V=({id:e,onChange:t,options:o=[],value:s=P})=>{const{setValidationErrors:n,clearValidationError:l}=(0,d.useDispatch)(i.VALIDATION_STORE_KEY),{validationError:p,validationErrorId:m}=(0,d.useSelect)((t=>{const o=t(i.VALIDATION_STORE_KEY);return{validationError:o.getValidationError(e),validationErrorId:o.getValidationErrorId(e)}}));(0,a.useEffect)((()=>(s===P?n({[e]:{message:(0,c.__)("Please select a house number","postcode-eu-address-validation"),hidden:!0}}):l(e),()=>l(e))),[s,n,l]);const g=p?.message&&!p?.hidden;return(0,r.createElement)("div",{className:$("postcode-eu-house-number-select",{"has-error":g})},(0,r.createElement)("div",{className:"wc-blocks-components-select"},(0,r.createElement)("div",{className:"wc-blocks-components-select__container"},(0,r.createElement)("label",{htmlFor:e,className:"wc-blocks-components-select__label"},(0,c.__)("Which house number do you mean?","postcode-eu-address-validation")),(0,r.createElement)("select",{className:"wc-blocks-components-select__select",id:e,onChange:e=>t(e.target.value),value:s,"aria-invalid":g,"aria-errormessage":m},(0,r.createElement)("option",{key:P,value:P},(0,c.__)("Select house number","postcode-eu-address-validation")),o.map((e=>(0,r.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,r.createElement)(_,{className:"wc-blocks-components-select__expand",icon:T}))),(0,r.createElement)(u.ValidationInputError,{propertyName:e,elementId:e}))},R=(0,y.jsx)(A.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,y.jsx)(A.Path,{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM12.75 8V13H11.25V8H12.75ZM12.75 14.5V16H11.25V14.5H12.75Z"})}),x=({id:e})=>{const{error:t,errorId:o}=(0,d.useSelect)((t=>{const o=t(i.VALIDATION_STORE_KEY);return{error:o.getValidationError(e),errorId:o.getValidationErrorId(e)}}));return t?.hidden||!t?.message?null:(0,r.createElement)("div",{className:"postcode-eu-address-lookup-error",role:"alert"},(0,r.createElement)("p",{id:o},(0,r.createElement)(_,{icon:R}),(0,r.createElement)("span",null,t.message)))},F=({formattedAddress:e})=>e?(0,r.createElement)("address",{className:"postcode-eu-autofill-address"},e):null,M=(0,l.getSetting)("postcode-eu-address-validation_data");"undefined"!=typeof window&&(window.PostcodeEuFieldMappingConstants=f);let L=!1;const j=({addressType:e,address:t,setAddress:o})=>{const s=(0,a.useRef)(null),n=(0,a.useRef)(t),[d,i]=(0,a.useState)(null),[l,c]=(0,a.useState)(!1),u=`${e}-postcode-eu-address_autocomplete`,p=Object.hasOwn(M.enabledCountries,t.country);n.current=t;const m=(0,a.useCallback)((()=>{o({...n.current,address_1:"",city:"",postcode:""}),i(null)}),[o,i]);(0,a.useEffect)((()=>{const t=()=>{const t=document.getElementById(`${e}-address_1`)?.parentElement;return t?.before(s.current),t};if(!t()){const e=new MutationObserver((o=>{o.forEach((()=>{t()&&e.disconnect()}))}));return e.observe(s.current.closest(".wc-block-components-checkout-step__content"),{childList:!0}),()=>e.disconnect()}}),[]),(0,a.useEffect)((()=>{if("showAll"!==M.displayMode)for(const t of["address_1","postcode","city"]){const o=document.getElementById(`${e}-${t}`)?.parentElement;o&&(o.style.display=l?"none":"")}}),[e,l]),(0,a.useEffect)((()=>{c(p)}),[c,p]),(0,a.useEffect)((()=>{L=!0}),[]);const g={addressType:e,address:t,setAddress:o,setFormattedAddress:i,addressRef:n,resetAddress:m,didInit:L};return(0,r.createElement)("div",{className:"postcode-eu-autofill-container",ref:s,style:l?{}:{display:"none"}},p&&(0,r.createElement)(r.Fragment,null,"NL"===t.country&&"postcodeOnly"===M.netherlandsMode?(0,r.createElement)(k,{...g}):(0,r.createElement)(v,{id:u,...g}),"y"===M.allowAutofillIntlBypass&&"showAll"!==M.displayMode&&(0,r.createElement)(N,{forId:u,onClick:()=>c(!1)}),(0,r.createElement)(F,{formattedAddress:d})))};(0,s.registerCheckoutBlock)({metadata:n,component:()=>{const{getUseShippingAsBilling:e,getEditingShippingAddress:t}=(0,d.useSelect)((e=>e(i.CHECKOUT_STORE_KEY)),[]),{shippingAddress:o}=(0,d.useSelect)((e=>e(i.CART_STORE_KEY).getCustomerData()),[]),{setShippingAddress:s,setBillingAddress:n}=(0,d.useDispatch)(i.CART_STORE_KEY),l=(0,a.useCallback)((t=>{s(t),e()&&n({...t})}),[e,s,n]);return t()?(0,r.createElement)(j,{addressType:"shipping",address:o,setAddress:l}):null}})})();