(()=>{"use strict";var e={20:(e,t,s)=>{var r=s(609),o=Symbol.for("react.element"),n=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};t.jsx=function(e,t,s){var r,l={},c=null,i=null;for(r in void 0!==s&&(c=""+s),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(i=t.ref),t)n.call(t,r)&&!d.hasOwnProperty(r)&&(l[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===l[r]&&(l[r]=t[r]);return{$$typeof:o,type:e,key:c,ref:i,props:l,_owner:a.current}}},848:(e,t,s)=>{e.exports=s(20)},609:e=>{e.exports=window.React}},t={};function s(r){var o=t[r];if(void 0!==o)return o.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,s),n.exports}const r=window.wc.blocksCheckout,o=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"postcode-eu-address-validation/shipping-address-autocomplete","version":"1.0.0","title":"International Address Autocomplete","category":"woocommerce","description":"Autocomplete international addresses using the Postcode.eu API.","example":{},"parent":["woocommerce/checkout-shipping-address-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"postcode-eu-address-validation"}');var n=s(609);const a=window.wp.data,d=window.wp.element,l=window.wc.wcBlocksData,c=window.wc.wcSettings,i=window.wp.i18n,u=window.wc.blocksComponents;function p(e){return["address_1","city","postcode"].every((t=>void 0===(0,a.select)(l.VALIDATION_STORE_KEY).getValidationError(`${e}_${t}`)))}var m,E;null!==(E=(m=PostcodeNl).addressDetailsCache)&&void 0!==E||(m.addressDetailsCache=new Map);let h=!1;const f=({id:e,addressType:t,address:s,setAddress:r,setFormattedAddress:o,addressRef:c,resetAddress:m,didInit:E})=>{const f=(0,d.useRef)(null),[_,v]=(0,d.useState)(!1),[g,w]=(0,d.useState)(!1),[A,y]=(0,d.useState)((()=>E?"":(e=>["postcode","city","address_1","address_2"].map((t=>e[t])).join(" ").trim())(s))),b=(0,d.useRef)(A),{setValidationErrors:I,clearValidationError:C}=(0,a.useDispatch)(l.VALIDATION_STORE_KEY),S=function(e){const t=(0,n.useRef)(null),s=(0,n.useCallback)((e=>PostcodeNl.addressDetailsCache.has(e)?Promise.resolve(PostcodeNl.addressDetailsCache.get(e)):new Promise((s=>{t.current.getDetails(e,(t=>{s(t),PostcodeNl.addressDetailsCache.set(e,t)}))}))),[]),r=(0,n.useCallback)(((...s)=>t.current.search(e.current,...s)),[]);return(0,n.useEffect)((()=>(t.current=new PostcodeNl.AutocompleteAddress(e.current,{autocompleteUrl:x.autocomplete,addressDetailsUrl:x.getDetails}),t.current.getSuggestions=function(e,t,s){const r=(new TextEncoder).encode(t),o=Array.from(r,(e=>String.fromCodePoint(e))).join(""),n=this.options.autocompleteUrl.replace("${context}",encodeURIComponent(e)).replace("${term}",encodeURIComponent(btoa(o)));return this.xhrGet(`${n}`,s)},t.current.getDetails=function(e,t){const s=this.options.addressDetailsUrl.replace("${context}",encodeURIComponent(e));return this.xhrGet(s,t)},()=>t.current.destroy())),[e]),{get instance(){return t.current},getAddressDetails:s,search:r}}(f,s.country),{validationError:N,validationErrorId:T}=(0,a.useSelect)((t=>{const s=t(l.VALIDATION_STORE_KEY);return{validationError:s.getValidationError(e),validationErrorId:s.getValidationErrorId(e)}})),O=(0,d.useCallback)(((s=!0)=>{p(t)?C(e):I({[e]:{message:(0,i.__)("Please enter an address and select it","postcode-eu-address-validation"),hidden:s}})}),[t,e,C,I]),k=(0,d.useCallback)((e=>{v(!0),S.getAddressDetails(e.context).then((e=>{const{locality:t,postcode:s,building:n}=e.address;r({...c.current,address_1:e.streetLine,city:t,postcode:s}),"default"===x.displayMode&&o(e.mailLines.join("\n")),O(!1)})).finally((()=>v(!1)))}),[v,r,o,O]),D=(0,d.useCallback)((()=>{f.current.addEventListener("autocomplete-response",(e=>{const t=e.detail.matches;1===t.length&&"Address"===t[0].precision?k(t[0]):O(!0)}),{once:!0}),S.search({term:b.current,showMenu:!1})}),[k,O]);(0,d.useEffect)((()=>{f.current.addEventListener("autocomplete-select",(e=>{y(e.detail.value),e.preventDefault(),"Address"===e.detail.precision&&k(e.detail)})),f.current.addEventListener("autocomplete-search",m),f.current.addEventListener("autocomplete-error",(()=>{v(!1),I({[e]:{message:(0,i.__)("An error has occurred while retrieving address data. Please contact us if the problem persists.","postcode-eu-address-validation"),hidden:!1}})})),f.current.addEventListener("autocomplete-open",(()=>w(!0))),f.current.addEventListener("autocomplete-close",(()=>w(!1)))}),[y,m,v,I,w]),(0,d.useEffect)((()=>{var t;h&&(S.instance.reset(),y("")),S.instance.setCountry(x.enabledCountries[s.country].iso3),m();const r=(0,a.select)(l.VALIDATION_STORE_KEY).getValidationError(e);O(null===(t=r?.hidden)||void 0===t||t)}),[s.country,m,y,e]),(0,d.useEffect)((()=>()=>C(e)),[C,e]),(0,d.useEffect)((()=>{f.current.classList.toggle(`${S.instance.options.cssPrefix}loading`,_)}),[_]),(0,d.useEffect)((()=>{D(),h=!0}),[D]);const V=N?.message&&!N?.hidden;return(0,n.createElement)(u.TextInput,{id:e,required:!0,className:{"has-error":V},ref:f,label:(0,i.__)("Start typing your address or zip/postal code","postcode-eu-address-validation"),value:A,onChange:e=>{O(!0),y(e)},onBlur:()=>!g&&O(!1),"aria-invalid":!0===V,ariaDescribedBy:V&&T?T:null,feedback:(0,n.createElement)(u.ValidationInputError,{propertyName:e,elementId:e}),title:""})},_=(0,d.forwardRef)((function({icon:e,size:t=24,...s},r){return(0,d.cloneElement)(e,{width:t,height:t,...s,ref:r})})),v=window.wp.primitives;var g=s(848);const w=(0,g.jsx)(v.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,g.jsx)(v.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),A=({forId:e,onClick:t})=>{const s=(0,a.useSelect)((t=>t(l.VALIDATION_STORE_KEY).getValidationError(e))),{clearValidationError:r}=(0,a.useDispatch)(l.VALIDATION_STORE_KEY);return s&&!s.hidden?(0,n.createElement)("span",{className:"postcode-eu-autofill-intl-bypass"},(0,n.createElement)(_,{icon:w}),(0,n.createElement)("a",{onClick:()=>{r(e),t()}},(0,i.__)("Enter an address"))):null},y=/([1-9]\d{3})\s*([A-Z]{2})/i,b=/([1-9]\d{0,4})(\D.*)?$/i,I=Object.freeze({VALID:"valid",NOT_FOUND:"notFound",ADDITION_INCORRECT:"houseNumberAdditionIncorrect"}),C="_",S=({addressType:e,address:t,setAddress:s,setFormattedAddress:r,addressRef:o,resetAddress:c,didInit:m})=>{var E;const h=`${e}-postcode-eu-postcode`,f=`${e}-postcode-eu-house_number`,_=`${e}-postcode-eu-house_number_select`,v=`${e}-postcode-eu-address-lookup-error`,[g,w]=(0,d.useState)(null!==(E=t.postcode)&&void 0!==E?E:""),[A,S]=(0,d.useState)((()=>m?"":(e=>{const t=[...`${e.address_1} ${e.address_2}`.matchAll(/[1-9]\d{0,4}\D*/g)];return 0===t[0]?.index&&t.shift(),1===t.length?t[0][0].trim():""})(t))),[N,T]=(0,d.useState)(C),[O,D]=(0,d.useState)([]),[R,$]=(0,d.useState)(null),[L,P]=(0,d.useState)(null),[j,U]=(0,d.useState)(!1),[K,M]=(0,d.useState)({status:null,address:null}),Y=(0,d.useRef)(),{setValidationErrors:B,clearValidationError:F}=(0,a.useDispatch)(l.VALIDATION_STORE_KEY),H=(0,d.useCallback)((()=>p(e)),[e]),Z=(0,d.useCallback)((e=>{const t=y.exec(e.value);return $(null===t?null:t[1]+t[2]),H()||null!==t}),[$]),G=(0,d.useCallback)((e=>{var t;const s=b.exec(e.value);return P(null===s?null:`${s[1]} ${null!==(t=s[2]?.trim())&&void 0!==t?t:""}`.trim()),H()||null!==s}),[P]),z=(0,d.useCallback)((({status:e,address:t})=>{F(v),e===I.NOT_FOUND?B({[v]:{message:(0,i.__)("Address not found.","postcode-eu-address-validation"),hidden:!1}}):e===I.ADDITION_INCORRECT&&D(t.houseNumberAdditions.map((e=>({value:e,label:`${t.houseNumber} ${e}`.trim()}))))}),[F,v,B,D]);return(0,d.useEffect)((()=>{if(c(),D([]),T(C),null!==R&&null!==L)return Y.current=window.setTimeout((()=>{U(!0),((e,t)=>{const s=x.dutchAddressLookup.replace("${postcode}",encodeURIComponent(e)).replace("${houseNumberAndAddition}",encodeURIComponent(t));return fetch(s).then((e=>{if(e.ok)return e.json();throw new Error(e.statusText)}))})(R,L).then((e=>{z(e),M(e)})).catch((()=>{B({[v]:{message:(0,i.__)("An error has occurred. Please try again later or contact us.","postcode-eu-address-validation"),hidden:!1}})})).finally((()=>U(!1)))}),750),()=>window.clearTimeout(Y.current)}),[c,D,T,R,L,U,M]),(0,d.useEffect)((()=>{const{status:e,address:t}=K;if(e===I.VALID){var n;const e=`${t.houseNumber} ${null!==(n=t.houseNumberAddition)&&void 0!==n?n:""}`.trim();s({...o.current,address_1:`${t.street} ${e}`,city:t.city,postcode:t.postcode}),"default"===x.displayMode&&r(`${t.street} ${e}\n${t.postcode} ${t.city}`)}else c(),r(null)}),[K,r,s,c]),(0,d.useEffect)((()=>()=>F(v)),[F,v]),(0,d.useEffect)((()=>{M((e=>{if(null===e.address)return e;const t=N===C;return{address:{...e.address,houseNumberAddition:t?null:N},status:t?null:I.VALID}}))}),[N,M]),(0,n.createElement)(n.Fragment,null,(0,n.createElement)(u.ValidatedTextInput,{id:h,label:(0,i.__)("Postcode","postcode-eu-address-validation"),value:g,onChange:w,customValidation:Z,errorMessage:(0,i.__)("Please enter a valid postcode","postcode-eu-address-validation")}),(0,n.createElement)(u.ValidatedTextInput,{id:f,label:(0,i.__)("House number and addition","postcode-eu-address-validation"),value:A,onChange:S,customValidation:G,errorMessage:(0,i.__)("Please enter a valid house number","postcode-eu-address-validation")}),O.length>0&&(0,n.createElement)(k,{id:_,options:O,value:N,onChange:T}),(0,n.createElement)("div",{className:"postcode-eu-address-lookup-status"},j&&(0,n.createElement)(u.Spinner,null),(0,n.createElement)(V,{id:v})))};function N(e){var t,s,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e)){var o=e.length;for(t=0;t<o;t++)e[t]&&(s=N(e[t]))&&(r&&(r+=" "),r+=s)}else for(s in e)e[s]&&(r&&(r+=" "),r+=s);return r}const T=function(){for(var e,t,s=0,r="",o=arguments.length;s<o;s++)(e=arguments[s])&&(t=N(e))&&(r&&(r+=" "),r+=t);return r},O=(0,g.jsx)(v.SVG,{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,g.jsx)(v.Path,{d:"M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"})}),k=({id:e,onChange:t,options:s=[],value:r=C})=>{const{setValidationErrors:o,clearValidationError:c}=(0,a.useDispatch)(l.VALIDATION_STORE_KEY),{validationError:p,validationErrorId:m}=(0,a.useSelect)((t=>{const s=t(l.VALIDATION_STORE_KEY);return{validationError:s.getValidationError(e),validationErrorId:s.getValidationErrorId(e)}}));(0,d.useEffect)((()=>(r===C?o({[e]:{message:(0,i.__)("Please select a house number","postcode-eu-address-validation"),hidden:!0}}):c(e),()=>c(e))),[r,o,c]);const E=p?.message&&!p?.hidden;return(0,n.createElement)("div",{className:T("postcode-eu-house-number-select",{"has-error":E})},(0,n.createElement)("div",{className:"wc-blocks-components-select"},(0,n.createElement)("div",{className:"wc-blocks-components-select__container"},(0,n.createElement)("label",{htmlFor:e,className:"wc-blocks-components-select__label"},(0,i.__)("Which house number do you mean?","postcode-eu-address-validation")),(0,n.createElement)("select",{className:"wc-blocks-components-select__select",id:e,onChange:e=>t(e.target.value),value:r,"aria-invalid":E,"aria-errormessage":m},(0,n.createElement)("option",{key:C,value:C},(0,i.__)("Select house number","postcode-eu-address-validation")),s.map((e=>(0,n.createElement)("option",{key:e.value,value:e.value},e.label)))),(0,n.createElement)(_,{className:"wc-blocks-components-select__expand",icon:O}))),(0,n.createElement)(u.ValidationInputError,{propertyName:e,elementId:e}))},D=(0,g.jsx)(v.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,g.jsx)(v.Path,{d:"M12 4C7.58172 4 4 7.58172 4 12C4 16.4183 7.58172 20 12 20C16.4183 20 20 16.4183 20 12C20 7.58172 16.4183 4 12 4ZM12.75 8V13H11.25V8H12.75ZM12.75 14.5V16H11.25V14.5H12.75Z"})}),V=({id:e})=>{const{error:t,errorId:s}=(0,a.useSelect)((t=>{const s=t(l.VALIDATION_STORE_KEY);return{error:s.getValidationError(e),errorId:s.getValidationErrorId(e)}}));return t?.hidden||!t?.message?null:(0,n.createElement)("div",{className:"postcode-eu-address-lookup-error",role:"alert"},(0,n.createElement)("p",{id:s},(0,n.createElement)(_,{icon:D}),(0,n.createElement)("span",null,t.message)))},R=({formattedAddress:e})=>e?(0,n.createElement)("address",{className:"postcode-eu-autofill-address"},e):null,x=(0,c.getSetting)("postcode-eu-address-validation_data");let $=!1;const L=({addressType:e,address:t,setAddress:s})=>{const r=(0,d.useRef)(null),o=(0,d.useRef)(t),[a,l]=(0,d.useState)(null),[c,i]=(0,d.useState)(!1),u=`${e}-postcode-eu-address_autocomplete`,p=Object.hasOwn(x.enabledCountries,t.country);o.current=t;const m=(0,d.useCallback)((()=>{s({...o.current,address_1:"",city:"",postcode:""}),l(null)}),[s,l]);(0,d.useEffect)((()=>{const t=()=>{const t=document.getElementById(`${e}-address_1`)?.parentElement;return t?.before(r.current),t};if(!t()){const e=new MutationObserver((s=>{s.forEach((()=>{t()&&e.disconnect()}))}));return e.observe(r.current.closest(".wc-block-components-checkout-step__content"),{childList:!0}),()=>e.disconnect()}}),[]),(0,d.useEffect)((()=>{if("showAll"!==x.displayMode)for(const t of["address_1","postcode","city"]){const s=document.getElementById(`${e}-${t}`)?.parentElement;s&&(s.style.display=c?"none":"")}}),[e,c]),(0,d.useEffect)((()=>{i(p)}),[i,p]),(0,d.useEffect)((()=>{$=!0}),[]);const E={addressType:e,address:t,setAddress:s,setFormattedAddress:l,addressRef:o,resetAddress:m,didInit:$};return(0,n.createElement)("div",{className:"postcode-eu-autofill-container",ref:r,style:c?{}:{display:"none"}},p&&(0,n.createElement)(n.Fragment,null,"NL"===t.country&&"postcodeOnly"===x.netherlandsMode?(0,n.createElement)(S,{...E}):(0,n.createElement)(f,{id:u,...E}),"showAll"!==x.displayMode&&(0,n.createElement)(A,{forId:u,onClick:()=>i(!1)}),(0,n.createElement)(R,{formattedAddress:a})))};(0,r.registerCheckoutBlock)({metadata:o,component:()=>{const{getUseShippingAsBilling:e,getEditingShippingAddress:t}=(0,a.useSelect)((e=>e(l.CHECKOUT_STORE_KEY)),[]),{shippingAddress:s}=(0,a.useSelect)((e=>e(l.CART_STORE_KEY).getCustomerData()),[]),{setShippingAddress:r,setBillingAddress:o}=(0,a.useDispatch)(l.CART_STORE_KEY),c=(0,d.useCallback)((t=>{r(t),e()&&o({...t})}),[e,r,o]);return t()?(0,n.createElement)(L,{addressType:"shipping",address:s,setAddress:c}):null}})})();